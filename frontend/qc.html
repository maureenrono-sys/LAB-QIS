<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>QC Analytics | Lab-QIS</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="sidebar">
        <div class="text-center pb-4 border-bottom border-secondary">
            <h4 class="text-white fw-bold">LAB-QIS</h4>
        </div>
        <div class="mt-3">
            <a href="dashboard.html" class="nav-link">Dashboard</a>
            <a href="departments.html" class="nav-link">Departments</a>
            <a href="qc.html" class="nav-link active">Quality Control</a>
            <a href="indicators.html" class="nav-link">Quality Indicators</a>
            <a href="equipment.html" class="nav-link">Equipment Log</a>
            <a href="nc-capa.html" class="nav-link">NC & CAPA</a>
            <a href="documents.html" class="nav-link">Documents</a>
            <a href="audits.html" class="nav-link">SLIPTA Audits</a>
            <a href="analytics.html" class="nav-link">Risk & Analytics</a>
        </div>
    </div>
    <div class="container-fluid p-4" style="margin-left: 250px;">
        <h3 class="fw-bold text-navy mb-4">Internal Quality Control (IQC)</h3>
        
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card card-clinical p-3">
                    <label class="form-label fw-bold small">Select Analyte</label>
                    <select id="analyteSelect" class="form-select">
                        <option>Hemoglobin (Level 2)</option>
                        <option>Glucose (Normal)</option>
                        <option>Creatinine (High)</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="card card-clinical p-4">
            <h5 class="fw-bold"><i class="bi bi-graph-up"></i> Levey-Jennings Chart</h5>
            <div style="height: 400px;">
                <canvas id="ljChart"></canvas>
            </div>
            <div class="mt-3 p-3 bg-light rounded">
                <small class="fw-bold text-muted text-uppercase">Westgard Rule Violations:</small>
                <div id="westgardAlert" class="text-success small fw-bold mt-1">âœ“ No violations detected (In Control)</div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const ctx = document.getElementById('ljChart').getContext('2d');
        
        // Mock Data for L-J Chart (Mean = 12.0, SD = 0.5)
        const mean = 12.0;
        const sd = 0.5;
        const days = Array.from({length: 20}, (_, i) => `Day ${i+1}`);
        const values = [11.9, 12.1, 12.0, 12.2, 11.8, 12.5, 12.0, 12.3, 11.9, 12.1, 12.4, 12.0, 11.7, 12.2, 12.0, 12.1, 11.9, 12.0, 12.2, 12.1];

        

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: days,
                datasets: [
                    {
                        label: 'Daily Control Value',
                        data: values,
                        borderColor: '#1a2a6c',
                        backgroundColor: '#1a2a6c',
                        borderWidth: 2,
                        pointRadius: 4
                        pointBackgroundColor: function(context) {
                            const value = context.dataset.data[context.dataIndex];
                            if (Math.abs(value - mean) > 3 * sd) return 'red';    // 1-3s violation
                            if (Math.abs(value - mean) > 2 * sd) return 'orange'; // 1-2s warning
                            return '#1a2a6c'; // Normal
                        }
                    },
                    // SD Lines
                    { label: 'Mean', data: Array(20).fill(mean), borderColor: 'green', borderDash: [5, 5], fill: false, pointRadius: 0 },
                    { label: '+2SD', data: Array(20).fill(mean + (2*sd)), borderColor: 'orange', borderDash: [2, 2], fill: false, pointRadius: 0 },
                    { label: '-2SD', data: Array(20).fill(mean - (2*sd)), borderColor: 'orange', borderDash: [2, 2], fill: false, pointRadius: 0 },
                    { label: '+3SD', data: Array(20).fill(mean + (3*sd)), borderColor: 'red', fill: false, pointRadius: 0 },
                    { label: '-3SD', data: Array(20).fill(mean - (3*sd)), borderColor: 'red', fill: false, pointRadius: 0 }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { min: mean - (4*sd), max: mean + (4*sd) }
                }
            }
        });
    </script>
</body>
</html>
